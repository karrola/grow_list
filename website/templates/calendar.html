{% extends "base.html" %}

{% block head %}
<script src="{{ url_for('static', filename='index.global.min.js') }}"></script>
<link href="{{ url_for('static', filename='calendar.css') }}" rel="stylesheet" />
{% endblock %}

{% block content %}

<div id="calendar"></div>


<button id="toggle-past-days" onclick="togglePastDays()">Pokaż wcześniejsze dni</button>
<button id="toggle-more-past-days" onclick="showMorePastDays()" style="display: none;">Pokaż więcej poprzednich dni</button>

<div id="past-days" style="display: none;">
  {% for day in all_past_days %}
    <div class="day past-day" id="day-{{ day }}" style="{% if loop.index > 10 %}display: none;{% endif %}">
      <h4>{{ day }}</h4>
      <ul>
        {% if events_by_date[day] %}
          {% for event in events_by_date[day] %}
            <li>{{ event.title }}</li>
          {% endfor %}
        {% else %}
          <li>Brak zadań</li>
        {% endif %}
      </ul>
    </div>
  {% endfor %}
</div>



<div id="future-days">
  {% for day in future_days %}
    <div class="day" id="day-{{ day }}">
      <h4>{{ day }}</h4>
      <ul>
        {% if events_by_date[day] %}
          {% for event in events_by_date[day] %}
            <li>{{ event.title }}</li>
          {% endfor %}
        {% else %}
          <li>Brak zadań</li>
        {% endif %}
      </ul>
      <button onclick="addTask('{{ day }}')">Dodaj zadanie</button>
    </div>
  {% endfor %}
</div>


 </div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'pl',
      firstDay: 1,
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: ''
      },
      events: {{ events|tojson }},
      dateClick: function(info) {
        const dateId = 'day-' + info.dateStr;
        const target = document.getElementById(dateId);
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }
    });
    calendar.render();
  });

  let pastVisibleCount = 10;

function togglePastDays() {
  const pastDays = document.getElementById('past-days');
  const toggleButton = document.getElementById('toggle-past-days');
  const moreButton = document.getElementById('toggle-more-past-days');

  if (pastDays.style.display === 'none') {
    pastDays.style.display = 'block';
    toggleButton.textContent = 'Ukryj wcześniejsze dni';
    moreButton.style.display = 'inline-block';
  } else {
    pastDays.style.display = 'none';
    toggleButton.textContent = 'Pokaż wcześniejsze dni';
    moreButton.style.display = 'none';
  }
}

function showMorePastDays() {
  const allPastDays = document.querySelectorAll('.past-day');
  const total = allPastDays.length;
  const nextCount = pastVisibleCount + 10;

  for (let i = pastVisibleCount; i < nextCount && i < total; i++) {
    allPastDays[i].style.display = 'block';
  }

  pastVisibleCount = nextCount;

  if (pastVisibleCount >= total) {
    document.getElementById('toggle-more-past-days').style.display = 'none';
  }
}
  function addTask(date) {
    alert('Dodaj zadanie do dnia: ' + date);
    // Można tu zrobić redirect albo popup
    // window.location.href = `/add-task?date=${date}`;
  }
</script>

{% endblock %}