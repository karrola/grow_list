{% extends "base.html" %}
{% block title %}{{list.list_title}}{% endblock %}
{% block head %}
<link href="{{ url_for('static', filename='list.css') }}" rel="stylesheet" />
{% endblock %}

{% block content %}
<h2 class="list-title"> {{list.list_title}} </h2>

<div class="task-list">
<ul class="tasks" id="tasks">
  {% for task in list.tasks if not task.if_done%}
  <li class="task">
    <form method="POST" action="{{ url_for('views.update_task', task_id=task.id) }}" class="form-check">
    <input type="checkbox" name="if_done" value="true" {% if task.if_done %}checked{% endif %} onchange="this.form.submit()">
    </form>
    <p class="task-data">{{ task.data }}</p>
    <span class="task-deadline text-muted">
    <i class="fa-solid fa-calendar-days"></i> {{ task.deadline_date.strftime('%d.%m.%Y') if task.deadline_date else '-' }}
    <i class="fa-solid fa-clock"></i> {{ task.deadline_time.strftime('%H:%M') if task.deadline_time else '-' }}
    </span>
    <button type="button" class="close" onClick="deleteTask({{ task.id }})">
    <span aria-hidden="true">&times;</span>
    </button>
  </li>
  {% endfor %}
</ul>

<!-- przycisk "dodaj zadanie" -->
<button type="button" class="toggle-add-task-form btn btn-outline-secondary btn-sm" onclick="addTaskForm(this)">Dodaj zadanie</button>
{% set done_tasks = list.tasks | selectattr('if_done') | list %}
{% if done_tasks %}
  <button type="button" id="show-done-tasks" class="btn btn-outline-secondary btn-sm" onclick="showDoneTasks(this)">Pokaż wykonane zadania</button>
{% endif %}

<!-- formularz dodawania zadania -->
<div class="add-task-form" id="add-task-form" style="display: none;">
    <form method="POST">
      <input type="text" name="task" id="task" class="task-data-input" autocomplete="off" placeholder="Wpisz treść zadania..." required><br>
      <span class="text-muted">
        <i class="fa-solid fa-calendar-days"></i>
        <input type="date" name="deadline_date" id="deadline_date" class="deadline-date">
      </span>
      <span class="text-muted">
        <i class="fa-solid fa-clock"></i>
        <input type="time" name="deadline_time" id="deadline_time" class="deadline-time">
      </span>
      <div class="submit-add-task-form-buttons">
        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="cancelTaskForm(this)">Anuluj</button>
        <button type="submit" class="btn btn-primary btn-sm">Dodaj zadanie</button>
      </div>
    </form>
</div>
</div>

<div id="done-tasks" style="display: none;">
<div class="task-list">
{% set done_tasks = list.tasks | selectattr('if_done') | list %}
{% if done_tasks %}
<ul class="tasks" id="tasks">
  <h5>Wykonane</h5>
  {% for task in list.tasks if task.if_done %}
  <li class="task">
    <form method="POST" action="{{ url_for('views.update_task', task_id=task.id) }}" class="form-check">
    <input type="checkbox" name="if_done" value="true" {% if task.if_done %}checked{% endif %} onchange="this.form.submit()">
    </form>
    <p class="task-data">{{ task.data }}</p>
    <span class="task-deadline text-muted">
    <i class="fa-solid fa-calendar-days"></i> {{ task.deadline_date.strftime('%d.%m.%Y') if task.deadline_date else '-' }}
    <i class="fa-solid fa-clock"></i> {{ task.deadline_time.strftime('%H:%M') if task.deadline_time else '-' }}
    </span>
    <button type="button" class="close" onClick="deleteTask({{ task.id }})">
      <span aria-hidden="true">&times;</span>
    </button>
  </li>
  {% endfor %}
</ul>
{% endif %}
</div>
</div>


<script>
  window.addEventListener("load", () => {
    if (window.history.replaceState) {
      window.history.replaceState(null, "", window.location.pathname);
    }
  });
  // formularz dodawania zadania
  function addTaskForm(button) {
    const formContainer = document.getElementById('add-task-form');            // <div class="add-task-form">

    formContainer.style.display = 'block';
    button.style.display = 'none'; // ukryj przycisk

    // scroll do formularza na środek
    formContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
  // anulowanie dodawania zadania
  function cancelTaskForm(button) {
    const form = button.closest('form');
    const formContainer = form.parentElement;
    const toggleButton = formContainer.previousElementSibling;

    form.reset();
    formContainer.style.display = 'none';
    toggleButton.style.display = 'inline-block'; // pokaż przycisk "Dodaj zadanie"
  }

  // pokaż/ukryj wykonane zadania
    // pokaż/ukryj wykonane zadania
  function showDoneTasks(button) {
    const doneTasks = document.getElementById('done-tasks');

    if (doneTasks.style.display === 'none') {
      doneTasks.style.display = 'block';
      button.textContent = 'Ukryj wykonane zadania';
    } else {
      doneTasks.style.display = 'none';
      button.textContent = 'Pokaż wykonane zadania';
    }
  }
</script>
{% endblock %}

